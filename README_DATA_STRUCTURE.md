# Sport插件数据结构设计文档

## 📋 **数据层次设计**

Sport插件采用三层数据结构设计，确保数据的灵活性和可扩展性：

### 🏗️ **设计架构**

```
sport_category (项目大类)
    ↓
sport_base_item (基础运动项目)
    ↓  
sport_item (具体比赛项目)
```

### 📊 **表结构说明**

#### 1. sport_category - 项目大类表
**作用**：定义运动项目的顶级分类
**示例数据**：
- 田径、球类、水上运动、体操类、武术类、极限运动、冰雪运动、格斗类、射击类、棋类、趣味比赛、其他

#### 2. sport_base_item - 基础运动项目表
**作用**：定义基础运动类型，不包含具体性别、距离等细分
**示例数据**：
- 游泳类：自由泳、仰泳、蛙泳、蝶泳、个人混合泳、自由泳接力、混合泳接力
- 田径类：短跑、中长跑、长跑、马拉松、跳远、跳高、铅球、接力
- 球类：足球、篮球、排球、乒乓球、羽毛球
- 趣味类：拔河、三人四足、袋鼠跳、跳绳

#### 3. sport_item - 具体比赛项目表
**作用**：基于基础项目创建具体的比赛项目，包含性别、距离、年龄组等详细信息
**示例数据**：
- 基于"自由泳"创建：男子50米自由泳、女子50米自由泳、男子100米自由泳、女子100米自由泳...
- 基于"篮球"创建：男子5人制篮球、女子5人制篮球、男子3人制篮球、女子3人制篮球...

## 📁 **数据文件说明**

### 1. 核心安装文件
- **install.sql** - 主安装脚本，包含表结构和基础示例数据
- **uninstall.sql** - 卸载脚本，删除所有相关数据表

### 2. 基础数据文件
- **sport_base_item_data.sql** - 详细的基础运动项目数据（推荐使用）
- **sport_item_example.sql** - 具体比赛项目示例，演示如何创建细分项目

### 3. 参考说明文件
- **README_DATA_STRUCTURE.md** - 本说明文档
- **sport_all.sql** - 完整数据库结构参考文件

## 🚀 **使用指南**

### 基础安装流程

1. **安装插件基础结构**
   ```sql
   SOURCE niucloud/addon/sport/sql/install.sql;
   ```

2. **选择基础数据方案**
   
   **方案A：使用详细基础数据（推荐）**
   ```sql
   SOURCE sport_base_item_data.sql;
   ```
   
   **方案B：使用简化数据**
   - install.sql已包含基础示例数据，无需额外操作

3. **根据赛事需求创建具体比赛项目**
   - 参考 `sport_item_example.sql` 中的示例
   - 在创建赛事时动态生成具体比赛项目

### 实际使用示例

#### 创建游泳赛事的完整流程

1. **选择基础项目**：从 `sport_base_item` 表选择"自由泳"
2. **创建具体项目**：在 `sport_item` 表创建：
   - 男子50米自由泳
   - 女子50米自由泳  
   - 男子100米自由泳
   - 女子100米自由泳
   - 等等...

#### 前端开发流程

1. **大类选择**：用户选择"水上运动"
2. **基础项目选择**：显示自由泳、仰泳、蛙泳等选项
3. **细节配置**：为每个基础项目配置性别、距离、年龄组等
4. **生成比赛项目**：系统自动创建对应的 `sport_item` 记录

## 🔧 **开发建议**

### 后端开发

1. **服务层设计**
   ```php
   // 获取某分类下的基础项目
   CategoryService::getBaseItems($categoryId)
   
   // 基于基础项目创建具体比赛项目
   ItemService::createFromBaseItem($baseItemId, $config)
   ```

2. **数据权限控制**
   - 所有数据必须与 `member_id` 关联
   - 确保用户只能操作自己的数据

### 前端开发

1. **多级联动选择**
   ```javascript
   // 分类 -> 基础项目 -> 具体项目配置
   category → base_item → item_config
   ```

2. **动态表单生成**
   - 根据基础项目类型动态生成配置表单
   - 支持批量创建具体比赛项目

## ⚠️ **注意事项**

1. **数据一致性**
   - 删除基础项目前检查是否有具体项目引用
   - 删除分类前检查是否有基础项目存在

2. **性能优化**
   - 基础项目数据相对固定，可以考虑缓存
   - 具体项目数据动态生成，注意查询优化

3. **扩展性**
   - 新增运动项目只需在基础项目表添加记录
   - 系统会自动支持该项目的细分创建

## 📖 **数据字典**

### competition_type 比赛类型
- 1: 个人赛
- 2: 团体赛

### gender_type 性别类型  
- 1: 男子
- 2: 女子
- 3: 混合

### status 状态
- 0: 禁用
- 1: 启用

---

**维护者**：NiuCloud Team  
**更新时间**：2024-03-21  
**版本**：v1.0.0 